<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>ã‚¿ãƒƒãƒ—RPG å®Œå…¨ç‰ˆ</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{background:#111;color:#fff;font-family:sans-serif;text-align:center;margin:0;padding:20px}
button{font-size:18px;padding:14px 26px;margin:6px}
input{font-size:16px;padding:8px;width:140px}
#tapBtn{font-size:28px;padding:32px 64px;margin-top:20px}
.hidden{display:none!important}
.boss{font-size:80px}
.player{font-size:60px;margin:10px}
.hp-bar{width:80%;height:20px;background:#444;margin:10px auto;border-radius:10px;overflow:hidden}
.hp{height:100%;background:red}
.overlay{
  position:fixed;inset:0;background:rgba(0,0,0,.9);
  display:flex;justify-content:center;align-items:center;
  z-index:999;font-size:22px;text-align:center;flex-direction:column
}
.spin{font-size:80px;animation:spin 1s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}
.rare{color:#4af}.sr{color:#c6f}.hr{color:#fa4}.ur{color:gold}
.lr{
  background:linear-gradient(45deg,red,orange,yellow,green,cyan,blue,purple);
  -webkit-background-clip:text;color:transparent;font-weight:bold
}
</style>
</head>
<body>

<h1>ğŸ”¥ ã‚¿ãƒƒãƒ—RPG ğŸ”¥</h1>

<div id="ui">
<p>ğŸ’° <span id="coin">0</span>ã€€ğŸ’ <span id="dia">0</span></p>
<p>âš” æ”»æ’ƒåŠ› +<span id="atk">0</span></p>

<div class="player" id="player">ğŸ™‚</div>

<button onclick="drawGacha()">ğŸ° ã‚¬ãƒãƒ£</button>
<button onclick="drawGacha10()">ğŸ° 10é€£</button><br>

<button onclick="drawDiaGacha()">ğŸ’ ä¸Šä½ã‚¬ãƒãƒ£</button>
<button onclick="drawDiaGacha10()">ğŸ’ ä¸Šä½10é€£</button><br>

<input id="diaInput" type="number" min="1" placeholder="ğŸ’æ•°">
<button onclick="exchangeDiaCustom()">ğŸ’°â†’ğŸ’</button>
<button onclick="showDex()">ğŸ“– å›³é‘‘</button>

<hr>
<button id="rushBtn" onclick="startRush()">ğŸ”¥ ãƒœã‚¹ãƒ©ãƒƒã‚·ãƒ¥</button>
</div>

<div id="select"><h2>ãƒœã‚¹é¸æŠ</h2></div>

<div id="game" class="hidden">
<h2 id="bossName"></h2>
<div class="boss" id="bossIcon"></div>
<div class="hp-bar"><div class="hp" id="hp"></div></div>
<p>HP: <span id="hpText"></span></p>
<p id="timer" class="hidden"></p>
<button id="tapBtn">ã‚¿ãƒƒãƒ—ï¼</button>
</div>

<div id="overlay" class="overlay hidden"></div>

<script>
/* ===== ä¿å­˜ãƒ‡ãƒ¼ã‚¿ ===== */
let coin = +localStorage.getItem("coin") || 0;
let dia = +localStorage.getItem("dia") || 0;
let atkBonus = +localStorage.getItem("atkBonus") || 0;
let dex = JSON.parse(localStorage.getItem("dex") || "{}");

/* ===== çŠ¶æ…‹ ===== */
let mode="normal";
let bossHp,maxHp,reward;
let rushEndTime,rushCount=0,rushIndex=0,rushInterval;

/* ===== DOM ===== */
const coinEl=document.getElementById("coin");
const diaEl=document.getElementById("dia");
const atkEl=document.getElementById("atk");
const overlay=document.getElementById("overlay");
const select=document.getElementById("select");
const rushBtn=document.getElementById("rushBtn");
const ui=document.getElementById("ui");
const timerEl=document.getElementById("timer");
const diaInput=document.getElementById("diaInput");

/* ===== ãƒœã‚¹ ===== */
const bosses=[
["ã‚¹ãƒ©ã‚¤ãƒ ",100,"ğŸŸ¢",10],
["ã‚ªãƒ¼ã‚¯",300,"ğŸ‘¹",20],
["ãƒ‰ãƒ©ã‚´ãƒ³",500,"ğŸ‰",50],
["ã‚´ãƒ¼ãƒ¬ãƒ ",1200,"ğŸ—¿",120],
["ãƒ‡ãƒ¼ãƒ¢ãƒ³",2500,"ğŸ˜ˆ",250],
["ç¥ç«œ",5000,"ğŸ²âœ¨",500],
["é­”ç‹",20000,"ğŸ‘‘ğŸ˜ˆ",2000],
["å¤ä»£ç«œ",50000,"ğŸ‰ğŸ”¥",5000],
["çµ‚ç„‰ã®ç¥",200000,"ğŸŒŒğŸ‘",20000]
];

/* ===== UIæ›´æ–° ===== */
function refresh(){
 coinEl.textContent=coin;
 diaEl.textContent=dia;
 atkEl.textContent=atkBonus.toFixed(1);
 localStorage.setItem("coin",coin);
 localStorage.setItem("dia",dia);
 localStorage.setItem("atkBonus",atkBonus);
 localStorage.setItem("dex",JSON.stringify(dex));
}
refresh();

/* ===== ãƒœã‚¹é¸æŠç”Ÿæˆ ===== */
bosses.forEach(b=>{
 const btn=document.createElement("button");
 btn.textContent=b[0];
 btn.onclick=()=>startBattle(...b);
 select.appendChild(btn);
});

/* ===== Overlay ===== */
function showOverlay(h){
 overlay.innerHTML=h+"<br><small>(ã‚¿ãƒƒãƒ—ã§é–‰ã˜ã‚‹)</small>";
 overlay.classList.remove("hidden");
}
overlay.onclick=()=>overlay.classList.add("hidden");

/* ===== ã‚¬ãƒãƒ£æ¼”å‡º ===== */
function gachaAnim(cb){
 overlay.innerHTML='<div class="spin">ğŸ°</div>';
 overlay.classList.remove("hidden");
 setTimeout(cb,1000);
}

/* ===== é€šå¸¸ã‚¬ãƒãƒ£ ===== */
function normalRoll(){
 const r=Math.random()*100;
 if(r<2)return["LR",1.5,"lr"];
 if(r<7)return["UR",1,"ur"];
 if(r<22)return["HR",0.5,"hr"];
 if(r<50)return["SR",0.3,"sr"];
 return["ãƒ¬ã‚¢",0.1,"rare"];
}

function drawGacha(){
 if(coin<100)return showOverlay("ã‚³ã‚¤ãƒ³ä¸è¶³ï¼");
 coin-=100;refresh();
 gachaAnim(()=>{
  const g=normalRoll();
  atkBonus+=g[1];
  dex[g[0]]=(dex[g[0]]||0)+1;
  refresh();
  showOverlay(`âœ¨${g[0]} +${g[1]}`);
 });
}

function drawGacha10(){
 if(coin<1000)return showOverlay("ã‚³ã‚¤ãƒ³ä¸è¶³ï¼");
 coin-=1000;refresh();
 gachaAnim(()=>{
  let h="<h3>10é€£</h3>";
  for(let i=0;i<10;i++){
   const g=normalRoll();
   atkBonus+=g[1];
   dex[g[0]]=(dex[g[0]]||0)+1;
   h+=`<div>${g[0]} +${g[1]}</div>`;
  }
  refresh();
  showOverlay(h);
 });
}

/* ===== ä¸Šä½ã‚¬ãƒãƒ£ ===== */
function diaRoll(){
 const r=Math.random()*100;
 if(r<15)return["ãƒ‡ã‚£ãƒã‚¤ãƒ³",10,"lr"];
 if(r<60)return["ã‚¦ãƒ«ãƒˆãƒ©ãƒ¬ã‚¢",1,"ur"];
 return["ãƒ¬ã‚¸ã‚§ãƒ³ãƒ‰ãƒ¬ã‚¢",1.5,"lr"];
}

function drawDiaGacha(){
 if(dia<1)return showOverlay("ãƒ€ã‚¤ãƒ¤ä¸è¶³ï¼");
 dia--;refresh();
 gachaAnim(()=>{
  const g=diaRoll();
  atkBonus+=g[1];
  dex[g[0]]=(dex[g[0]]||0)+1;
  refresh();
  showOverlay(`ğŸ’ ${g[0]} +${g[1]}`);
 });
}

function drawDiaGacha10(){
 if(dia<10)return showOverlay("ãƒ€ã‚¤ãƒ¤ä¸è¶³ï¼");
 dia-=10;refresh();
 gachaAnim(()=>{
  let h="<h3>ğŸ’ ä¸Šä½10é€£</h3>";
  for(let i=0;i<10;i++){
   const g=diaRoll();
   atkBonus+=g[1];
   dex[g[0]]=(dex[g[0]]||0)+1;
   h+=`<div>${g[0]} +${g[1]}</div>`;
  }
  refresh();
  showOverlay(h);
 });
}

/* ===== ã‚³ã‚¤ãƒ³â†’ãƒ€ã‚¤ãƒ¤ï¼ˆä¿®æ­£ç‰ˆï¼‰ ===== */
function exchangeDiaCustom(){
 const n=Number(diaInput.value);
 if(!Number.isInteger(n) || n<=0) return showOverlay("æ­£ã—ã„æ•°ã‚’å…¥åŠ›ï¼");
 if(coin < n*1000) return showOverlay("ã‚³ã‚¤ãƒ³ä¸è¶³ï¼");
 coin -= n*1000;
 dia += n;
 refresh();
 showOverlay(`ğŸ’ +${n}`);
}

/* ===== å›³é‘‘ ===== */
function showDex(){
 let h="<h2>ğŸ“– å›³é‘‘</h2>";
 for(let k in dex)h+=`<div>${k} Ã— ${dex[k]}</div>`;
 showOverlay(h);
}

/* ===== ãƒãƒˆãƒ« ===== */
function startBattle(n,h,i,r){
 mode="normal";
 bossHp=maxHp=h;
 reward=r;
 bossName.textContent=n;
 bossIcon.textContent=i;
 timerEl.classList.add("hidden");
 select.classList.add("hidden");
 game.classList.remove("hidden");
 updateHp();
}

/* ===== ãƒœã‚¹ãƒ©ãƒƒã‚·ãƒ¥ ===== */
function startRush(){
 mode="rush";
 rushCount=0;
 rushIndex=0;
 ui.classList.add("hidden");
 rushBtn.classList.add("hidden");
 select.classList.add("hidden");
 game.classList.remove("hidden");
 timerEl.classList.remove("hidden");
 rushEndTime=Date.now()+60000;
 rushInterval=setInterval(updateRushTimer,100);
 nextRush();
}

function updateRushTimer(){
 const t=Math.max(0,((rushEndTime-Date.now())/1000).toFixed(1));
 timerEl.textContent="æ®‹ã‚Š "+t+" ç§’";
 if(t<=0) endRush();
}

function nextRush(){
 const b=bosses[rushIndex%bosses.length];
 bossHp=maxHp=b[1];
 reward=b[3];
 bossName.textContent=b[0];
 bossIcon.textContent=b[2];
 updateHp();
 rushIndex++;
}

function endRush(){
 clearInterval(rushInterval);
 game.classList.add("hidden");
 select.classList.remove("hidden");
 ui.classList.remove("hidden");
 rushBtn.classList.remove("hidden");
 const bonus=rushCount*100;
 coin+=bonus;
 refresh();
 showOverlay(`ğŸ”¥ ãƒœã‚¹ãƒ©ãƒƒã‚·ãƒ¥çµ‚äº†<br>${rushCount}ä½“æ’ƒç ´<br>ğŸ’° +${bonus}`);
}

/* ===== ã‚¿ãƒƒãƒ— ===== */
tapBtn.onclick=()=>{
 bossHp=Math.max(0,bossHp-(1+atkBonus));
 updateHp();
 if(bossHp===0){
  if(mode==="normal"){
   coin+=reward;
   refresh();
   game.classList.add("hidden");
   select.classList.remove("hidden");
   showOverlay(`ğŸ‰ æ’ƒç ´ï¼<br>ğŸ’° +${reward}`);
  }else{
   rushCount++;
   coin+=reward;
   refresh();
   nextRush();
  }
 }
};

function updateHp(){
 hpText.textContent=Math.ceil(bossHp);
 hp.style.width=(bossHp/maxHp*100)+"%";
}
</script>
</body>
</html>
